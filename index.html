<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <meta name="description" content="Contador moderno de s√©ries com timer de treino e descanso" />
  <meta name="theme-color" content="#4F46E5" />
  <title>Contador de S√©ries</title>
  <style>
    :root {
      --card-gap: 12px;
      --series-max-h: 128px; /* ajustado p/ iPhone 15 Pro Max */
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; -webkit-text-size-adjust: 100%; }
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,'Fira Sans','Droid Sans','Helvetica Neue',sans-serif;
      background: linear-gradient(135deg,#f0f4ff 0%,#e0e7ff 50%,#f3e8ff 100%);
      min-height:100svh;height:100svh;overflow:hidden;display:flex;align-items:center;justify-content:center;
      padding:max(10px,env(safe-area-inset-top,0px)) max(10px,env(safe-area-inset-right,0px))
              max(10px,env(safe-area-inset-bottom,0px)) max(10px,env(safe-area-inset-left,0px));
      touch-action:manipulation; overscroll-behavior:none; -webkit-user-select:none; user-select:none;
    }
    .container{width:100%;max-width:420px;}
    .card{
      background:#fff;border-radius:16px;box-shadow:0 20px 25px -5px rgba(0,0,0,.1);
      padding:12px;display:grid;gap:var(--card-gap);
      /* header, total, rest, stats, input, list flex, rodap√© */
      grid-template-rows:auto auto auto auto auto 1fr auto;
      height:calc(100svh - 2 * max(10px, env(safe-area-inset-bottom,0px)));
    }
    .header{text-align:center}
    .header h1{font-weight:700;color:#1f2937;margin-bottom:4px;font-size:clamp(18px,4.5vw,22px)}
    .header p{color:#6b7280;font-size:clamp(11px,3.2vw,13px)}

    .timer-section{padding:10px;border-radius:12px;border:2px solid}
    .timer-total{background:linear-gradient(to right,#f0fdf4,#f0fdfa);border-color:#86efac}
    .timer-rest{background:linear-gradient(to right,#fef3c7,#fee2e2);border-color:#fbbf24}
    .timer-label{font-size:12px;font-weight:600;color:#374151;text-align:center;margin-bottom:6px}
    .timer-display{font-weight:800;text-align:center;font-family:'Courier New',monospace;letter-spacing:.08em;line-height:1;font-size:clamp(28px,8.6vw,40px);margin-bottom:6px}
    .timer-total .timer-display{color:#16a34a}
    .timer-rest .timer-display{color:#ea580c}

    .button-group{display:flex;gap:8px;justify-content:center}
    button{
      border:none;border-radius:10px;font-size:16px;font-weight:700;cursor:pointer;
      padding:10px 14px;transition:.2s;display:flex;align-items:center;justify-content:center;gap:6px;touch-action:manipulation
    }
    .btn-play{flex:1;background:#22c55e;color:#fff}
    .btn-play:hover{background:#16a34a}
    .btn-play.pause{background:#ef4444}
    .btn-play.pause:hover{background:#dc2626}
    .btn-reset{background:#fff;border:2px solid;color:#374151}
    .timer-total .btn-reset{border-color:#86efac;color:#16a34a}
    .timer-rest .btn-reset{border-color:#fbbf24;color:#ea580c}

    .stats{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .stat-box{background:#f3f4f6;border-radius:10px;padding:8px;text-align:center}
    .stat-box.blue{background:#eff6ff}
    .stat-box.indigo{background:#eef2ff}
    .stat-number{font-size:clamp(18px,5.8vw,26px);font-weight:800;margin-bottom:2px}
    .stat-box.blue .stat-number{color:#2563eb}
    .stat-box.indigo .stat-number{color:#4f46e5}
    .stat-label{font-size:12px;color:#6b7280}

    .input-section{background:linear-gradient(to right,#f0f4ff,#eef2ff);border-radius:12px;padding:10px}
    .input-label{font-size:12px;font-weight:700;color:#374151;margin-bottom:6px;display:block}
    .reps-control{display:flex;align-items:center;justify-content:center;gap:10px}
    .btn-control{
      width:44px;height:44px;padding:0;border-radius:10px;border:2px solid #d1d5db;background:#fff;
      font-size:22px;color:#374151;line-height:1;touch-action:manipulation
    }
    .btn-control:hover{border-color:#9ca3af}
    .reps-display{font-size:clamp(30px,9.5vw,44px);font-weight:800;color:#4f46e5;width:88px;text-align:center}
    .btn-plus{
      width:44px;height:44px;padding:0;border-radius:10px;background:linear-gradient(to right,#3b82f6,#4f46e5);
      color:#fff;border:none;font-size:22px;line-height:1;touch-action:manipulation
    }
    .btn-add-serie{width:100%;background:linear-gradient(to right,#3b82f6,#4f46e5);color:#fff;padding:10px;border-radius:10px;border:none;font-size:14px;font-weight:700;box-shadow:0 10px 15px -3px rgba(59,130,246,.25)}

    .series-list{overflow:hidden}
    .series-title-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
    .series-title{font-size:12px;font-weight:700;color:#374151}
    .toggle-group{display:flex;gap:6px}
    .toggle-btn{
      font-size:12px;padding:6px 10px;border:1px solid #d1d5db;border-radius:999px;background:#fff;color:#374151
    }
    .toggle-btn.active{background:#4f46e5;color:#fff;border-color:#4f46e5}

    .series-container{
      max-height:var(--series-max-h);overflow-y:auto;display:flex;flex-direction:column;gap:8px;padding-right:2px;
      -webkit-overflow-scrolling:touch
    }
    .serie-item{display:flex;align-items:center;justify-content:space-between;background:#f9fafb;padding:10px;border-radius:10px}
    .serie-info{display:flex;align-items:center;gap:10px}
    .serie-number{width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:linear-gradient(to right,#3b82f6,#4f46e5);color:#fff;border-radius:8px;font-weight:800;font-size:14px}
    .serie-details p{font-size:12px;font-weight:700;color:#1f2937;margin-bottom:2px}
    .serie-details .reps{font-size:14px;font-weight:800;color:#4f46e5}
    .btn-remove{width:28px;height:28px;padding:0;border-radius:8px;background:transparent;color:#ef4444;border:none;font-size:18px}
    .btn-remove:hover{background:#fee2e2;color:#b91c1c}
    .empty-state{text-align:center;padding:12px 0;color:#9ca3af;font-size:12px}

    .btn-reset-all{width:100%;background:#fff;border:2px solid #d1d5db;color:#374151;padding:10px;border-radius:10px;font-size:14px;font-weight:700}
    .footer{display:none} /* escondido p/ caber 1 tela */
    .motivation{text-align:center;color:#4b5563;font-size:12px}

    @supports (height: 100dvh) {
      body { min-height: 100dvh; height: 100dvh; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <!-- Header -->
      <div class="header">
        <h1>Contador de S√©ries</h1>
        <p>Acompanhe seu progresso de treino</p>
      </div>

      <!-- Total Workout Timer -->
      <div class="timer-section timer-total">
        <div class="timer-label">‚è±Ô∏è Tempo Total de Treino</div>
        <div class="timer-display" id="totalTime">00:00</div>
        <div class="button-group">
          <button class="btn-play" id="btnToggleTotal" aria-label="Iniciar/pausar tempo total"><span id="playIcon">‚ñ∂</span><span id="playText">Iniciar</span></button>
          <button class="btn-reset" id="btnResetTotal" aria-label="Zerar tempo total">‚Üª</button>
        </div>
      </div>

      <!-- Rest Timer (sempre vis√≠vel) -->
      <div id="restTimerSection" class="timer-section timer-rest">
        <div class="timer-label">‚è±Ô∏è Tempo de Descanso</div>
        <div class="timer-display" id="restTime">00:00</div>
        <div class="button-group">
          <button class="btn-play" id="btnToggleRest" aria-label="Iniciar/pausar descanso"><span id="playIconRest">‚ñ∂</span><span id="playTextRest">Iniciar</span></button>
          <button class="btn-reset" id="btnResetRest" aria-label="Zerar tempo de descanso">‚Üª</button>
        </div>
      </div>

      <!-- Stats -->
      <div class="stats">
        <div class="stat-box blue"><div class="stat-number" id="totalSeries">0</div><div class="stat-label">S√©ries</div></div>
        <div class="stat-box indigo"><div class="stat-number" id="totalReps">0</div><div class="stat-label">Repeti√ß√µes</div></div>
      </div>

      <!-- Input Section -->
      <div class="input-section">
        <label class="input-label">Repeti√ß√µes da s√©rie atual</label>
        <div class="reps-control">
          <button class="btn-control" id="btnDecrease" aria-label="Diminuir repeti√ß√µes">‚àí</button>
          <div class="reps-display" id="currentReps">0</div>
          <button class="btn-plus" id="btnIncrease" aria-label="Aumentar repeti√ß√µes">+</button>
        </div>
        <button class="btn-add-serie" id="btnAddSerie" aria-label="Adicionar s√©rie">+ Adicionar S√©rie</button>
      </div>

      <!-- Series List -->
      <div class="series-list">
        <div class="series-title-row">
          <div class="series-title">Hist√≥rico de S√©ries</div>
          <div class="toggle-group">
            <button id="btnViewHistorico" class="toggle-btn active" aria-pressed="true">Hist√≥rico</button>
            <button id="btnViewAcumulado" class="toggle-btn" aria-pressed="false">Acumulado</button>
          </div>
        </div>
        <div class="series-container" id="seriesContainer">
          <div class="empty-state">Nenhuma s√©rie adicionada ainda. Comece a treinar! üí™</div>
        </div>
      </div>

      <!-- Reset Button -->
      <button class="btn-reset-all" id="btnResetAll">‚Üª Resetar Tudo</button>

      <!-- Motivation -->
      <div class="motivation" id="motivation"></div>
    </div>
  </div>

  <script>
    /* ===== Anti-zoom por teclado/gesto ===== */
    document.addEventListener('keydown', e => {
      if ((e.ctrlKey || e.metaKey) && ['+','-','='].includes(e.key)) e.preventDefault();
    }, { passive:false });
    document.addEventListener('wheel', e => { if (e.ctrlKey) e.preventDefault(); }, { passive:false });
    ['gesturestart','gesturechange','gestureend'].forEach(evt =>
      document.addEventListener(evt, e => e.preventDefault(), { passive:false })
    );

    // ===== Estado =====
    let series = [];
    let currentReps = 0;
    let restTime = 0;
    let totalTime = 0;
    let isRestRunning = false;
    let isTotalRunning = false;
    let viewMode = 'historico'; // 'historico' | 'acumulado'

    const STORAGE_KEY = 'contador-series';
    const STATE_KEY   = 'contador-series-state';

    // ===== Elementos =====
    const currentRepsEl = document.getElementById('currentReps');
    const totalSeriesEl = document.getElementById('totalSeries');
    const totalRepsEl   = document.getElementById('totalReps');
    const seriesContainerEl = document.getElementById('seriesContainer');
    const restTimeEl = document.getElementById('restTime');
    const totalTimeEl = document.getElementById('totalTime');
    const motivationEl = document.getElementById('motivation');

    const btnIncrease = document.getElementById('btnIncrease');
    const btnDecrease = document.getElementById('btnDecrease');
    const btnAddSerie = document.getElementById('btnAddSerie');
    const btnToggleRest = document.getElementById('btnToggleRest');
    const btnResetRest  = document.getElementById('btnResetRest');
    const btnToggleTotal= document.getElementById('btnToggleTotal');
    const btnResetTotal = document.getElementById('btnResetTotal');
    const btnResetAll   = document.getElementById('btnResetAll');

    const btnViewHistorico = document.getElementById('btnViewHistorico');
    const btnViewAcumulado = document.getElementById('btnViewAcumulado');

    // ===== Init =====
    function init(){
      loadData();
      loadState();
      attachEventListeners();
      updateUI();
      startTimers();
    }

    function loadData(){
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) { try { series = JSON.parse(saved) || []; } catch{} }
    }
    function saveData(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(series));
    }
    function loadState(){
      const s = localStorage.getItem(STATE_KEY);
      if (s) {
        try {
          const p = JSON.parse(s);
          restTime = p.restTime || 0;
          totalTime = p.totalTime || 0;
          isRestRunning = !!p.isRestRunning;
          isTotalRunning = !!p.isTotalRunning;
        } catch{}
      }
    }
    function saveState(){
      localStorage.setItem(STATE_KEY, JSON.stringify({ restTime,totalTime,isRestRunning,isTotalRunning }));
    }

    function formatTime(seconds){
      const m = Math.floor(seconds/60);
      const s = seconds%60;
      return String(m).padStart(2,'0')+':'+String(s).padStart(2,'0');
    }

    function renderSeries(){
      if (series.length === 0){
        seriesContainerEl.innerHTML = '<div class="empty-state">Nenhuma s√©rie adicionada ainda. Comece a treinar! üí™</div>';
        return;
      }
      if (viewMode === 'historico'){
        // Ex.: 1¬™ s√©rie: 10
        seriesContainerEl.innerHTML = series.map((s, i) => `
          <div class="serie-item">
            <div class="serie-info">
              <div class="serie-number">${i+1}</div>
              <div class="serie-details">
                <p>${i+1}¬™ s√©rie</p>
                <div class="reps">${s.reps} ${s.reps===1?'repeti√ß√£o':'repeti√ß√µes'}</div>
              </div>
            </div>
            <button class="btn-remove" aria-label="Remover s√©rie" onclick="removeSerie(${s.id})">√ó</button>
          </div>
        `).join('');
      } else {
        // Acumulado progressivo
        let run = 0;
        seriesContainerEl.innerHTML = series.map((s, i) => {
          run += s.reps;
          return `
            <div class="serie-item">
              <div class="serie-info">
                <div class="serie-number">${i+1}</div>
                <div class="serie-details">
                  <p>${i+1}¬™ s√©rie (acumulado)</p>
                  <div class="reps">${run} no total</div>
                </div>
              </div>
              <button class="btn-remove" aria-label="Remover s√©rie" onclick="removeSerie(${s.id})">√ó</button>
            </div>
          `;
        }).join('');
      }
    }

    function updateUI(){
      currentRepsEl.textContent = currentReps;
      totalSeriesEl.textContent = series.length;
      totalRepsEl.textContent   = series.reduce((sum,s)=>sum+s.reps,0);
      totalTimeEl.textContent   = formatTime(totalTime);
      restTimeEl.textContent    = formatTime(restTime);

      renderSeries();

      // motiva√ß√£o
      const t = series.length;
      let msg = '';
      if (t===1) msg='√ìtimo come√ßo! üéØ';
      else if (t>1 && t<5) msg='Voc√™ est√° no caminho certo! üî•';
      else if (t>=5 && t<10) msg='Impressionante! Voc√™ √© um guerreiro! üí™';
      else if (t>=10) msg='Voc√™ √© uma m√°quina! Parab√©ns pela dedica√ß√£o! üèÜ';
      motivationEl.textContent = msg;

      // estados bot√µes play/pause
      btnToggleRest.className  = isRestRunning  ? 'btn-play pause' : 'btn-play';
      btnToggleRest.innerHTML  = isRestRunning  ? '<span>‚è∏</span><span>Pausar</span>' : '<span>‚ñ∂</span><span>Iniciar</span>';
      btnToggleTotal.className = isTotalRunning ? 'btn-play pause' : 'btn-play';
      btnToggleTotal.innerHTML = isTotalRunning ? '<span>‚è∏</span><span>Pausar</span>' : '<span>‚ñ∂</span><span>Iniciar</span>';

      // estados toggle hist√≥rico/acumulado
      if (viewMode==='historico'){
        btnViewHistorico.classList.add('active'); btnViewHistorico.setAttribute('aria-pressed','true');
        btnViewAcumulado.classList.remove('active'); btnViewAcumulado.setAttribute('aria-pressed','false');
      } else {
        btnViewAcumulado.classList.add('active'); btnViewAcumulado.setAttribute('aria-pressed','true');
        btnViewHistorico.classList.remove('active'); btnViewHistorico.setAttribute('aria-pressed','false');
      }

      saveState();
    }

    function attachEventListeners(){
      const safe = fn => e => { e.preventDefault(); e.stopPropagation(); fn(); };

      btnIncrease.addEventListener('click', safe(() => { currentReps++; updateUI(); }));
      btnDecrease.addEventListener('click', safe(() => { if (currentReps>0) currentReps--; updateUI(); }));
      btnAddSerie .addEventListener('click', safe(() => {
        if (currentReps>0){
          series.push({ id: Date.now(), reps: currentReps });
          currentReps = 0;
          restTime = 0;         // zera descanso ao finalizar a s√©rie
          isRestRunning = true; // inicia descanso automaticamente
          if (!isTotalRunning) isTotalRunning = true;
          saveData(); updateUI();
        }
      }));
      btnToggleRest .addEventListener('click', safe(() => { isRestRunning  = !isRestRunning;  updateUI(); }));
      btnResetRest  .addEventListener('click', safe(() => { restTime       = 0; isRestRunning  = false; updateUI(); }));
      btnToggleTotal.addEventListener('click', safe(() => { isTotalRunning = !isTotalRunning; updateUI(); }));
      btnResetTotal .addEventListener('click', safe(() => { totalTime      = 0; isTotalRunning = false; updateUI(); }));

      btnResetAll.addEventListener('click', safe(() => {
        if (confirm('Tem certeza que deseja resetar tudo?')){
          series=[]; currentReps=0; restTime=0; totalTime=0; isRestRunning=false; isTotalRunning=false;
          localStorage.removeItem(STORAGE_KEY); localStorage.removeItem(STATE_KEY);
          updateUI();
        }
      }));

      btnViewHistorico.addEventListener('click', safe(() => { viewMode='historico'; updateUI(); }));
      btnViewAcumulado.addEventListener('click', safe(() => { viewMode='acumulado'; updateUI(); }));
    }

    function removeSerie(id){
      series = series.filter(s=>s.id!==id);
      saveData(); updateUI();
    }

    function startTimers(){
      setInterval(() => {
        if (isRestRunning)  restTime++;
        if (isTotalRunning) totalTime++;
        updateUI();
      }, 1000);
    }

    init();
  </script>
</body>
</html>
